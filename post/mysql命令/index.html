<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="Tang Blog">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://tangjiadong.github.io/https://tva1.sinaimg.cn/large/008i3skNgy1gqtn4hojr9j31hc0u0npg.jpg">
    <meta property="twitter:image" content="https://tangjiadong.github.io/https://tva1.sinaimg.cn/large/008i3skNgy1gqtn4hojr9j31hc0u0npg.jpg" />
    

    
    <meta name="title" content="《MySQL必知必会》-MySQL数据库常用命令" />
    <meta property="og:title" content="《MySQL必知必会》-MySQL数据库常用命令" />
    <meta property="twitter:title" content="《MySQL必知必会》-MySQL数据库常用命令" />
    

    
    <meta name="description" content="">
    <meta property="og:description" content="" />
    <meta property="twitter:description" content="" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>《MySQL必知必会》-MySQL数据库常用命令-汤家栋的博客 | Tangjiadong Blog</title>

    <link rel="canonical" href="/post/mysql%E5%91%BD%E4%BB%A4/">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>

    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet" type="text/css">

    
    

    
    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    

</head>



<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Tang Blog</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                        
                        <li>
                            <a href="/categories/java">java</a>
                        </li>
                        
                        <li>
                            <a href="/categories/web">web</a>
                        </li>
                        
                    
                    
		    
                        <li><a href="/top/resume/">Resume</a></li>
                    

                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('https://tangblog.oss-cn-shanghai.aliyuncs.com/02.jpg')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/java" title="java">
                            java
                        </a>
                        
                        <a class="tag" href="/tags/mysql" title="mysql">
                            mysql
                        </a>
                        
                    </div>
                    <h1>《MySQL必知必会》-MySQL数据库常用命令</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by 
                        
                            汤家栋
                         
                        on 
                        Thursday, December 5, 2019
                        
                            <span id="/post/mysql%E5%91%BD%E4%BB%A4/" class="leancloud_visitors meta_data_item" data-flag-title="">
    <span class="post-meta-item-icon">
      <span class="octicon octicon-eye"></span> 
    </span>
    <i class="fa fa-eye"></i>
    <span class="old-visitors-count" style="display: none;"></span>
    <span class="leancloud-visitors-count"></span>
</span>



<script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>

<script>
	AV.initialize("", "");
</script>

<script type="text/javascript">
function showTime(Counter) {
    var query = new AV.Query(Counter);
    var entries = [];
    var $visitors = $(".leancloud_visitors");

    $visitors.each(function() {
        entries.push($(this).attr("id").trim());
    });

    query.containedIn('url', entries);
    query.find()
        .done(function(results) {
            var COUNT_CONTAINER_REF = '.leancloud-visitors-count';
            var OLD_COUNT_CONTAINER_REF = '.old-visitors-count';

            
            
            
            

            for (var i = 0; i < results.length; i++) {
                var item = results[i];
                var url = item.get('url');
                var time = item.get('time');
                var element = document.getElementById(url);

                $(element).find(COUNT_CONTAINER_REF).text(time);
            }
            for (var i = 0; i < entries.length; i++) {
                var url = entries[i];
                var element = document.getElementById(url);
                var countSpan = $(element).find(COUNT_CONTAINER_REF);
                if (countSpan.text() == '') {
                    var oldCountSpan = $(element).find(OLD_COUNT_CONTAINER_REF).text();
                    if(oldCountSpan!=''){
                        countSpan.text(0+parseInt(oldCountSpan));
                    }else{
                        countSpan.text(0);          
                    }
                }
            }
        })
        .fail(function(object, error) {
            console.log("Error: " + error.code + " " + error.message);
        });
}

function addCount(Counter) {
    var $visitors = $(".leancloud_visitors");
    var url = $visitors.attr('id').trim();
    var title = $visitors.attr('data-flag-title').trim();
    var query = new AV.Query(Counter);

    query.equalTo("url", url);
    query.find({
        success: function(results) {
            if (results.length > 0) {
                var counter = results[0];
                counter.fetchWhenSave(true);
                counter.increment("time");
                counter.save(null, {
                    success: function(counter) {
                        var $element = $(document.getElementById(url));
                        $element.find('.leancloud-visitors-count').text(counter.get('time'));
                    },
                    error: function(counter, error) {
                        console.log('Failed to save Visitor num, with error message: ' + error.message);
                    }
                });
            } else {
                var newcounter = new Counter();
                 
                var acl = new AV.ACL();
                acl.setPublicReadAccess(true);
                acl.setPublicWriteAccess(true);
                newcounter.setACL(acl);
                 
                newcounter.set("title", title);
                newcounter.set("url", url);
                var OLD_COUNT_CONTAINER_REF = '.old-visitors-count';
                var $element = $(document.getElementById(url));
                var oldCountSpan = $element.find(OLD_COUNT_CONTAINER_REF).text();
                if(oldCountSpan!=''){
                    newcounter.set("time", parseInt(oldCountSpan)+1);
                }else{
 	                    newcounter.set("time",  1);
                }
                newcounter.save(null, {
                    success: function(newcounter) {
                        var $element = $(document.getElementById(url));
                        $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
                    },
                    error: function(newcounter, error) {
                        console.log('Failed to create');
                    }
                });
            }
        },
        error: function(error) {
            console.log('Error:' + error.code + " " + error.message);
        }
    });
}
$(function() {
    var Counter = AV.Object.extend("Counter");
    
    
    if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
    } else {
        showTime(Counter);
    }
});
</script>

                        
                        
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-11 col-lg-offset-1
                col-md-10 col-md-offset-1
                post-container">

                
                <header>
                    <h2>TOC</h2>
                </header>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#mysql命令">MySQL命令</a></li>
    <li><a href="#1-表或数据库操作语句">1. 表(或数据库)操作语句</a></li>
    <li><a href="#2-表数据操作语句">2 表数据操作语句</a></li>
    <li><a href="#3-sql中关键字执行顺序">3. SQL中关键字执行顺序</a></li>
    <li><a href="#4-索引">4. 索引</a></li>
    <li><a href="#5-存储过程">5. 存储过程</a></li>
    <li><a href="#6-事务处理">6. 事务处理</a></li>
    <li><a href="#7-触发器">7. 触发器</a></li>
  </ul>
</nav>
                
                <h2 id="mysql命令">MySQL命令</h2>
<p>MySQL的基本操作可以包括两个方面：MySQL常用语句如高频率使用的增删改查（CRUD）语句和MySQL高级功能，如存储过程，触发器，事务处理等。而这两个方面又可以细分如下：</p>
<ul>
<li>MySQL常用语句</li>
</ul>
<ol>
<li>表（或者数据库）的CRUD</li>
<li>表数据的CRUD，其中表数据查询使用最多，也更复杂。查询可以按照单表还是多表可以分为：单表SELECT查询和多表的联结查询（INNER JOIN, LEFT JOIN, RIGHT JOIN和FULL JOIN）以及组合查询UNION和UNION ALL</li>
<li>SQL语句中各个关键字的执行顺序</li>
</ol>
<ul>
<li>MySQL的高级功能</li>
</ul>
<ol>
<li>存储过程</li>
<li>事务处理</li>
<li>触发器</li>
</ol>
<h2 id="1-表或数据库操作语句">1. 表(或数据库)操作语句</h2>
<p><strong>1.1. 查询表（或数据库）</strong></p>
<ol>
<li><strong>获取所有可用的数据库</strong>：SHOW DATABASES；</li>
<li><strong>选择数据库</strong>：USE customers；</li>
<li>用于显示数据库服务器的状态信息：SHOW STATUS；</li>
<li>用来显示授权用户的安全权限：SHOW GRANTS；</li>
<li>用来显示数据库服务器或警告信息：SHOW ERRORS 或者 SHOW WARNINGS；</li>
<li><strong>用于显示创建数据库时的创建语句</strong>：SHOW CREATE DATABASE customers；</li>
<li><strong>用于显示创建表时的创建语句</strong>：SHOW CREATE TABLE customers；</li>
<li><strong>获取当前所选的数据库中所有可用的表</strong>：SHOW TABLES；</li>
<li><strong>获取表中所有列的信息</strong>：SHOW COLUMNS FROM tableName；同时DESCRIBE语句有相同的效果：DESCRIBE tableName；</li>
</ol>
<p><strong>1.2. 新建表（或）数据库</strong></p>
<ol>
<li><strong>新建数据库</strong>：CREATE DATABASE customers;</li>
<li><strong>创建表可以使用CREATE TABLE语句</strong>:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> customers(
 cust_id INT <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> AUTO_INCREMENT,
 cust_name CHAR(<span style="color:#ae81ff">50</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
 cust_age INT <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#ae81ff">18</span>,
 <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>(cust_id)
 )ENGINE<span style="color:#f92672">=</span>INNODB;
</code></pre></div><ol>
<li>有这样一些细节：</li>
<li>允许<strong>NULL</strong>值，则说明在插入行数据时允许不给出该列的值，而<strong>NOT NULL</strong>则表示在插入或者更新该列数据，必须明确给出该列的值；</li>
<li><strong>DEFAULT</strong>表示该列的默认值，在插入行数据时，若没有给出该列的值就会使用其指定的默认值；</li>
<li><strong>PRIMARY KEY</strong>用于指定主键，主键可以指定一列数据，而可以由多列数据组合构成，如PRIMARY KEY(cust_id,cust_name)；</li>
<li><strong>ENGINE</strong>用于指定引擎类型。常见的引擎类型有这些：（1）InnoDB是一个支持可靠的事务处理的引擎，但是不支持全文本搜索；（2）MyISAM是一个性能极高的引擎，它支持全文本搜索，但是不支持事务处理；（3）MEMORY在功能上等同于MyISAM，但由于数据存储在内存中，速度很快（特别适合于临时表）；</li>
<li>在创建表的时候可以使用<strong>FOREIGN KEY</strong>来创建外键，即一个表中的FOREIGN KEY指向另一个表中PRIMARY KEY。外键FOREIGN KEY用于约束破坏表的联结动作，保证两个表的数据完整性。同时也能防止非法数据插入外键列，因为该列值必须指向另一个表的主键。实例为：</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> Orders
 (
 Id_O int <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
 OrderNo int <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
 Id_P int,
 <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (Id_O),
 <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span> (Id_P) <span style="color:#66d9ef">REFERENCES</span> Persons(Id_P)
 )
</code></pre></div><p><strong>1.3 删除表（或数据库）</strong></p>
<ol>
<li><strong>删除数据库</strong>：DROP DATABASE customers；</li>
<li><strong>删除表</strong>，使用DROP TABLE子句：DROP TABLE customers。</li>
</ol>
<p><strong>1.4 更新表</strong></p>
<ol>
<li>更新表结构信息可以使用<strong>ALTER TABLE</strong>子句，如为表增加一列：ALTER TABLE vendors ADD vend_name CHAR(20)；另外经常用于定义外键，如：</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> customers 
 <span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">CONSTRAINT</span> fk_custormer_orders
 <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span>(cust_id) <span style="color:#66d9ef">REFERENCES</span> orders (order_cust)
</code></pre></div><ol>
<li><strong>重命名表，使用RENAME子句</strong>。RENAME TABLE backup_customers TO customers, backup_vendors TO vendors；更改多个表名，之间用逗号间隔</li>
</ol>
<h2 id="2-表数据操作语句">2 表数据操作语句</h2>
<p><strong>2.1 查询表数据</strong></p>
<blockquote>
<p><strong>基本查询语句</strong></p>
</blockquote>
<ol>
<li>根据过滤条件查询表中的单列或者多列或者全部列的信息<strong>SELECT FROM WEHERE</strong>：SELECT cust_id,cust_name FROM customers WHERE cust_id=10086；其中过滤条件操作符有：=，&lt;&gt;,!=,&lt;,&lt;=,&gt;,&gt;=,BETWEEN AND,IS NULL；</li>
<li>为查询出的某一列信息去重<strong>DISTINCT</strong>：SELECT DISTINCT cust_name FROM customers；</li>
<li>限制单列查询结果的行数：SELECT cust_name FROM customers LIMIT 5；LIMIT后跟一个数值，表示从第0行开始取，共取5行数据；如果LIMIT 5，5表示从第5行（数据库中实际第6行记录）开始取，共取5行数据。注意：数据是从第0行开始计数的；</li>
<li><strong>ORDER BY</strong>子句取一个或者多个列，据此对输出进行排序：SELECT cust_id,cust_name FROM customers ORDER BY cust_id DESC, cust_name;</li>
<li><strong>IN</strong>操作符用来指定条件范围，范围中的每个条件都可以进行匹配：SELECT cust_id, cust_name FROM customers WHERE cust_id IN (1000,2000)。另外，NOT操作符可以和IN操作符配合使用，用于表示检索出不符合条件的所有数据；</li>
<li><strong>LIKE</strong>操作符用来表明模糊查询，与之配合使用的通配符有**%**，%表示任何字符出现任何次数；_，_表示只能匹配一个字符：SELECT cust_id,cust_name FROM customers WHERE cust_name LIKE &lsquo;%happy%'；</li>
<li>使用分组查询并可以满足一定的分组过滤条件<strong>GROUP BY HAVING</strong>。如检索总计订单金额大于等于50的订单号和订单总金额，并按总金额进行排序：SELECT order_num,SUM(quantity<em>item_price) AS order_total FROM orderitems GROUP BY order_num HAVING SUM(quantity</em>item_price)&gt;=50 ORDER BY order_total</li>
<li><strong>WHERE和HAVING的比较</strong>。WHERE是行级过滤，而HAVING是组级过滤。被WHERE过滤掉的数据不会出现在分组中。WHERE中通配符以及多个WHERE子句的连接同样适用于HAVING子句；</li>
<li>GROUP BY的使用注意事项： （1）GROUP BY子句中可以嵌套分组（即通过多个列进行分组GROUP BY cust_id, cust_name），但是进行数据汇总时，是在最后规定的分组上进行；（2）GROUP BY子句中列出的每个列都必须是检索列或者是有效的表达式。（3）如果有NULL值，将值NULL作为一个分组进行返回，如果有多行NULL值，它们将分为一组</li>
<li>嵌套其他查询中的查询，称之为<strong>子查询</strong>。执行过程由里向外，里层查询结果作为外层查询的条件：SELECT cust_id FROM orders WHERE order_num IN (SELECT order_num FROM orderitems WHERE prod_id = &lsquo;happy&rsquo;)。当然，多表的查询可以是用联结查询。</li>
</ol>
<blockquote>
<p><strong>联结查询</strong></p>
</blockquote>
<ol>
<li>内联结用又称之为内部联结，是基于两个表 之间的的相等测试。如果不加过滤条件，会造成“笛卡尔积”。SELECT vend_name,prod_name,prod_price FROM vendors INNER JOIN products ON vendors.vend_id=products.vend_id；同样可以使用WHERE进行多表联结查询，但是更推荐使用INNER JOIN等联结方式；</li>
<li>外部联结包括左外联结<strong>LEFT JOIN</strong>和右外联结<strong>RIGHT JOIN</strong>和全连接<strong>FULL JOIN</strong>。例如查询每个客户的订单数：SELECT customers.cust_id,orders.orders_num FROM customers LEFT JOIN orders ON orders.cust_id =customers.cust_id；LEFT JOIN 会全部返回左表数据，RIGHT JOIN会全部返回右表数据，FULL JOIN会将左右两个表的数据全部返回；</li>
<li>联结查询与聚集函数一起使用。如查询每个客户的订单数：SELECT customers.cust_name,customers.cust_id,COUNT(orders.order_num) AS num_ord FROM customers INNER JOIN orders ON customers.cust_id=orders.cust_id GROUP BY customers.cust_id；</li>
</ol>
<blockquote>
<p><strong>组合查询</strong></p>
</blockquote>
<ol>
<li>多个查询（SELECT）可以使用UNION将多个查询结果进行合并成一个结果集返回，<strong>UNIO</strong>N必须包含两个及两个以上的SELECT查询，并且每个传必须包含相同的列、表达式或聚集函数，数据类型不必完全相同，MySQL会进行隐式的类型转换。SELECT vend_id,prod_id,prod_price FROM products WHERE prod_price&gt;5 UINON SELECT vend_id,prod_id,prod_price FROM products WHERE vend_id IN (1001,1002);</li>
<li><strong>UNION</strong>返回的是去重后的结果，如果不需要去重则可以使用<strong>UNION ALL</strong>；</li>
<li>可以多组合查询使用ORDER BY进行排序，但是是针对的最终的结果集进行排序，而不是其中单个SELECT查询进行排序，因此对于组合查询来说ORDER BY子句只有一个。SELECT vend_id,prod_id,prod_price FROM products WHERE prod_price&gt;5 UINON SELECT vend_id,prod_id,prod_price FROM products WHERE vend_id IN (1001,1002) ORDER BY vend_id</li>
</ol>
<blockquote>
<p><strong>使用函数对数据进行处理</strong></p>
</blockquote>
<ol>
<li>拼接列名：SELECT Concat (vendName,'(',vendCountry,')') FROM vendors ORDER BY vendName；</li>
<li>执行算术表达式计算：SELECT prodId, quantity,price, quantity*price AS expandedPrice FROM orderItems；</li>
<li>文本处理函数如Upper(),LTrim(),RTrim()等函数。比如使用Upper函数将文本转换成大写：SELECT vendName, Upper(vendName) FROM vendors ORDER BY vendName；</li>
<li>时间和日期处理函数，如Date(),Day()等。SELECT custId, orderNum FROM orders WHERE Date(orderDate)='2015-09-01&rsquo;；</li>
<li>数值处理函数，如Abs(),Cos()等；</li>
<li>常用的聚集函数。如AVG(),COUNT(),MAX(),MIN()以及SUM()。SELECT COUNT(*) AS numbers, MIN(prod_price) AS price_min, MAX(prod_price) AS price_max,AVG(prod_price) AS price_avg FROM products；</li>
</ol>
<p><strong>2.2 插入表数据</strong></p>
<ol>
<li>向表中插入行数据可以使用INSERT INTO子句，更安全的方式是指定列名。INSERT INTO customers (cust_name, cust_email) VALUES(&lsquo;happy&rsquo;,&lsquo;<a href="mailto:happy@gmail.com">happy@gmail.com</a>&rsquo;)；在INSERT INTO子句中能够省略列名的前提条件是：该列可以允许定义为NULL值或者在定义该列时给出去了默认值；</li>
<li>如果插入多行数据可以将多组值用逗号进行分隔即可。INSERT INTO customers (cust_name, cust_email) VALUES(&lsquo;happy&rsquo;,&lsquo;<a href="mailto:happy@gmail.com">happy@gmail.com</a>&rsquo;),(&lsquo;smart&rsquo;,&lsquo;<a href="mailto:smart@gmail.com">smart@gmail.com</a>&rsquo;)；</li>
<li>将查询出来的数据插入表中，可以使用INSERT SELECT语句。INSERT INTO customers(cust_id,cust_contact) SELECT cust_id, cust_contact FROM customers WHERE cust_id&gt;5；其中SELECT中可以带WHERE过滤条件；INSERT SELECT通常被用于复制表数据</li>
</ol>
<p><strong>2.3 更新表数据</strong></p>
<ol>
<li>如果要更新表数据的话，使用UPDATE子句：UPDATE customers SET cust_name ='happy&rsquo;,cust_<a href="mailto:email='happy@gmail.com">email='happy@gmail.com</a>&rsquo; WHERE cust_id = 1001；</li>
<li><strong>注意：如果不加WHERE条件指定到某一行的话，会更新表中某一列全部的数据</strong>。</li>
</ol>
<p><strong>2.4 删除表数据</strong></p>
<ol>
<li>如果从表中删除数据的话，可以使用DELETE子句。DELETE FROM customers WHERE cust_id = 10086；删除的数据必定是表中行数据，而不是某一列。因此，与UPDATE子句相比，DELETE子句并不需要指定是哪一列，而仅仅只需要指定具体的表名即可；</li>
<li><strong>注意：如果不添加WHERE指定条件的话，会将整个表中所有行数据全部删除。另外，DELETE只是删除表中的数据，而不会删除表结构信息；</strong></li>
<li>如果想删除表中全部的数据，可以使用<strong>TRUNCATE</strong>，比DELETE删除效率更高；</li>
</ol>
<h2 id="3-sql中关键字执行顺序">3. SQL中关键字执行顺序</h2>
<p>在SQL语句中每个关键字都会按照顺序往下执行，而每一步操作，会生成一个虚拟表，最后产生的虚拟表会作为执行的最终结果返回。下面的是常用的关键字的执行顺序：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">(<span style="color:#ae81ff">8</span>)<span style="color:#66d9ef">SELECT</span> (<span style="color:#ae81ff">9</span>)<span style="color:#66d9ef">DISTINCT</span><span style="color:#f92672">&lt;</span>select_list<span style="color:#f92672">&gt;</span>
(<span style="color:#ae81ff">1</span>)<span style="color:#66d9ef">FROM</span> <span style="color:#f92672">&lt;</span>left_table<span style="color:#f92672">&gt;</span>
(<span style="color:#ae81ff">3</span>)<span style="color:#f92672">&lt;</span>join_type<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">JOIN</span> <span style="color:#f92672">&lt;</span>right_table<span style="color:#f92672">&gt;</span>
(<span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">ON</span> <span style="color:#f92672">&lt;</span>join_condition<span style="color:#f92672">&gt;</span>
(<span style="color:#ae81ff">4</span>)<span style="color:#66d9ef">WHERE</span> <span style="color:#f92672">&lt;</span>where_condition<span style="color:#f92672">&gt;</span>
(<span style="color:#ae81ff">5</span>)<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span><span style="color:#f92672">&lt;</span>group_by_list<span style="color:#f92672">&gt;</span>
(<span style="color:#ae81ff">6</span>)<span style="color:#66d9ef">WITH</span><span style="color:#960050;background-color:#1e0010">{</span><span style="color:#66d9ef">CUBE</span><span style="color:#f92672">|</span><span style="color:#66d9ef">ROLLUP</span><span style="color:#960050;background-color:#1e0010">}</span>
(<span style="color:#ae81ff">7</span>)<span style="color:#66d9ef">HAVING</span><span style="color:#f92672">&lt;</span>having_condition<span style="color:#f92672">&gt;</span>
(<span style="color:#ae81ff">10</span>)<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span><span style="color:#f92672">&lt;</span>order_by_list<span style="color:#f92672">&gt;</span>
(<span style="color:#ae81ff">11</span>)<span style="color:#66d9ef">LIMIT</span><span style="color:#f92672">&lt;</span>limit_number<span style="color:#f92672">&gt;</span>
</code></pre></div><ol>
<li><strong>FROM</strong>：对FROM左边的表和右边的表计算笛卡尔积，产生虚表VT1；</li>
<li><strong>ON</strong>：对虚拟表VT1进行ON筛选，只有那些符合&lt;join_condition&gt;条件的行才会被记录在虚拟表VT2中；</li>
<li><strong>JOIN</strong>：如果是OUT JOIN，那么将保留表中（如左表或者右表）未匹配的行作为外部行添加到虚拟表VT2中，从而产生虚拟表VT3；</li>
<li><strong>WHERE</strong>:对虚拟表VT3进行WHERE条件过滤，只有符合&lt;where_condition&gt;的记录才会被放入到虚拟表VT4；</li>
<li><strong>GROUP BY</strong>：根据GROUP BY子句中的列，对虚拟表VT4进行分组操作，产生虚拟表VT5；</li>
<li><strong>CUBE|ROLLUP</strong>：对虚拟表VT5进行CUBE或者ROLLUP操作，产生虚拟表VT6；</li>
<li><strong>HAVING</strong>：对虚拟表VT6进行HAVING条件过滤，只有符合&lt;having_condition&gt;的记录才会被插入到虚拟表VT7中；</li>
<li><strong>SELECT</strong>：执行SELECT操作，选择指定的列，插入到虚拟表VT8中；</li>
<li><strong>DISTINCT</strong>：对虚拟表VT8中的记录进行去重，产生虚拟表VT9；</li>
<li><strong>ORDER BY</strong>：将虚拟表VT9中的记录按照&lt;order_by_list&gt;进行排序操作，产生虚拟表VT10；</li>
<li><strong>LIMIT</strong>：取出指定行的记录，产生虚拟表VT11，并将结果返回。</li>
</ol>
<h2 id="4-索引">4. 索引</h2>
<p>MySQL索引的建立对于MySQL的高效运行是很重要的，索引可以大大提高MySQL的检索速度。索引分单列索引和组合索引。单列索引，即一个索引只包含单个列，而组合索引，即一个索引包含多个列。</p>
<p><strong>4.1 创建索引</strong></p>
<p>创建索引有两种方式，一种是直接利用CREATE INDEX进行创建，另外一种则是通过修改表结构来进行添加，则是利用ALTER TABLE语句。</p>
<ol>
<li>使用CREATE INDEX</li>
<li>语法为：</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"> <span style="color:#66d9ef">CREATE</span> [<span style="color:#66d9ef">UNIQUE</span><span style="color:#f92672">|</span>FULLTEXT<span style="color:#f92672">|</span>SPATIAL] <span style="color:#66d9ef">INDEX</span> index_name
 [<span style="color:#66d9ef">USING</span> index_type]
 <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">table_name</span> (index_col_name,...)
</code></pre></div><ol>
<li>其中对应的语法变量信息如下：</li>
</ol>
<blockquote>
<p><strong>[UNIQUE|FULLTEXT|SPATIAL]</strong></p>
</blockquote>
<ol>
<li>其中括号中的这三个关键字表示创建的索引类型，它们分别表示<strong>唯一索引</strong>、<strong>全文索引</strong>、<strong>空间索引</strong>三种不同的索引类型。如果我们不指定任何关键字，则默认为普通索引。</li>
</ol>
<blockquote>
<p><strong>index_name</strong></p>
</blockquote>
<ol>
<li>index_name表示索引的名称，由用户自行定义，以便于以后对该索引进行修改等管理操作。</li>
</ol>
<blockquote>
<p><strong>index_type</strong></p>
</blockquote>
<ol>
<li>index_type表示索引的具体实现方式，在MySQL中，有两种不同形式的索引——BTREE索引和HASH索引。在存储引擎为MyISAM和InnoDB的表中只能使用BTREE，其默认值就是BTREE；在存储引擎为MEMORY或者HEAP的表中可以使用HASH和BTREE两种类型的索引，其默认值为HASH。</li>
</ol>
<blockquote>
<p><strong>index_colname</strong></p>
</blockquote>
<ol>
<li>index_col_name表示需要创建索引的字段名称，我们还可以针对多个字段创建复合索引，只需要在多个字段名称之间以英文逗号隔开即可。此外，对于CHAR或VARCHAR类型的字段，我们还可以只使用字段内容前面的一部分来创建索引，只需要在对应的字段名称后面加上形如(length)的指令即可，表示只需要使用字段内容前面的length个字符来创建索引。在这里，我们以customers表的cust_name字段(类型为VARCHAR(50))为例，使用cust_name字段的6个字符前缀来创建索引。</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">INDEX</span> idx_cust_name <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">user</span> (cust_name(<span style="color:#ae81ff">6</span>));
</code></pre></div><ol>
<li>使用ALTER TABLE</li>
<li>语法为：</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"> <span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">table_name</span>
 <span style="color:#66d9ef">ADD</span> [<span style="color:#66d9ef">UNIQUE</span><span style="color:#f92672">|</span>FULLTEXT<span style="color:#f92672">|</span>SPATIAL] <span style="color:#66d9ef">INDEX</span> index_name 
 (index_col_name,...) [<span style="color:#66d9ef">USING</span> index_type]
</code></pre></div><p><strong>4.2 删除索引</strong></p>
<p>删除指定表中指定名称的索引，语法为：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">table_name</span>
<span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">INDEX</span> index_name;
</code></pre></div><p>例如删除名称为idx_cust_name的索引，其SQL语句为：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> customers
<span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">INDEX</span> idx_cust_name;
</code></pre></div><p><strong>4.3 修改索引</strong></p>
<p>在MySQL中并没有提供修改索引的直接指令，一般情况下，我们需要先删除掉原索引，再根据需要创建一个同名的索引，从而变相地实现修改索引操作。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">--先删除
</span><span style="color:#75715e"></span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">user</span>
<span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">INDEX</span> idx_user_username;
<span style="color:#75715e">--再以修改后的内容创建同名索引
</span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">INDEX</span> idx_cust_name <span style="color:#66d9ef">ON</span> customers (cust_name(<span style="color:#ae81ff">8</span>));
</code></pre></div><p><strong>4.4 查看索引</strong></p>
<p>在MySQL中，要查看某个数据库表中的索引也非常简单，只需要使用以下两个命令中的任意一种即可。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">--如果查看索引前，没有使用user db_name等命令指定具体的数据库，则必须加上FROM db_name
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">INDEX</span> <span style="color:#66d9ef">FROM</span> <span style="color:#66d9ef">table_name</span> [<span style="color:#66d9ef">FROM</span> db_name]
<span style="color:#75715e">--如果查看索引前，没有使用user db_name等命令指定具体的数据库，则必须加上db_name.前缀
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">INDEX</span> <span style="color:#66d9ef">FROM</span> [db_name.]<span style="color:#66d9ef">table_name</span>
</code></pre></div><h2 id="5-存储过程">5. 存储过程</h2>
<ol>
<li>什么是存储过程？存储过程简单来说，就是为了复用性或者实现复杂的业务功能，而保存的一条或多条MySQL语句的集合，可将其视为批文件；</li>
<li>为什么使用存储过程？（1）通过把处理封装在容易使用的单元中，简化复杂的操作；（2）由于不要求反复建立一系列处理步骤，这保证了数据的完整性，如果所有的开发人员和应用程序都使用同一存储过程，则所使用的代码都是相同的；（3）简化对变动的管理。如果表名、列名或业务逻辑有变化，只需要更改存储过程的代码，使用它的开发人员甚至不需要知道这些变化，也就是具备了安全性；（4）提高了性能，因为使用存储过程比单独使用SQL语句要快；（5）存储过程可用来编写功能更灵活的代码。因此，存储过程的具备三个特性:<strong>简单可复用、安全以及高性能</strong>；</li>
<li>存储过程的缺点？（1）存储过程编写比基本的SQL语句更加复杂，需要更高的技能；（2）可能没有创建存储过程的权限，数据库管理员可能会限制创建存储过程的权限，允许用户使用存储过程，而不允许用户自由创建存储过程；</li>
</ol>
<blockquote>
<p><strong>创建存储过程</strong></p>
</blockquote>
<ol>
<li>创建存储过程。如需要统计用户订单总金额，如果该用户需要交税的话，订单总金额则需要再加上税费</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"> <span style="color:#66d9ef">DELIMITER</span> <span style="color:#f92672">//</span>
 <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">PROCEDURE</span> ordertotal(
 <span style="color:#66d9ef">IN</span> custid INT,
 <span style="color:#66d9ef">IN</span> taxable BOOLEAN,
 <span style="color:#66d9ef">OUT</span> ototal DECIMAL(<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">2</span>)
 )<span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;obtain total order price&#39;</span>
 
 <span style="color:#66d9ef">BEGIN</span>
 
 <span style="color:#75715e">/*declare variable for total*/</span>
 <span style="color:#66d9ef">DECLARE</span> total DECIMAL(<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">2</span>);
 <span style="color:#66d9ef">DECLARE</span> taxrate INT <span style="color:#66d9ef">DEFAULT</span> <span style="color:#ae81ff">6</span>;
 
 
 <span style="color:#75715e">/*get the order total*/</span>
 
 <span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">SUM</span>(item_price<span style="color:#f92672">*</span>item_quantity) <span style="color:#66d9ef">INTO</span> total
 <span style="color:#66d9ef">FROM</span> customers
 <span style="color:#66d9ef">WHERE</span> cust_id <span style="color:#f92672">=</span> custid;
 
 <span style="color:#75715e">/*is this taxable?*/</span>
 
 <span style="color:#66d9ef">IF</span> taxable <span style="color:#66d9ef">THEN</span>
 	<span style="color:#66d9ef">SELECT</span> total<span style="color:#f92672">+</span>(total<span style="color:#f92672">/</span><span style="color:#ae81ff">100</span><span style="color:#f92672">*</span>taxrate) <span style="color:#66d9ef">INTO</span> total;
 <span style="color:#66d9ef">END</span> <span style="color:#66d9ef">IF</span>;
 <span style="color:#66d9ef">SELECT</span> total <span style="color:#66d9ef">INTO</span> ototal;
 <span style="color:#66d9ef">END</span> <span style="color:#f92672">//</span>
</code></pre></div><p>有这样一些细节： 1. 使用CREATE PROCEDURE语句进行创建，（）圆括号中为存储过程的参数，其中参数类型有：1. <strong>IN</strong>类型，表示传递给存储过程；2. <strong>OUT</strong> 类型，表示存储过程返回的结果，在调用存储过程时需要传入@开始的变量；3. <strong>INOUT</strong>类型，表示在存储过程中可以传入和传出； 2. <strong>DECLARE</strong>用来声明一个变量，如这里的total，taxrate。注意MySQL中定义变量时都是变量名在前，数据类型在后。 3. 存储过程具体逻辑写在<strong>BEGIN END</strong>之间； 4. 将值赋给变量使用<strong>INTO</strong>关键字； 5. 由于存储过程中每个SQL语句中用；作为分隔符，会和单个SQL造成冲突，因此可使用<strong>DELIMITER</strong>重新定义分类符，如该例子中定义//为分隔符，自然存储过程结尾就用END //结尾，而不再是END。同时，分隔符//成对出现后，恢复到默认的&rdquo;;&ldquo;作为分隔符；</p>
<blockquote>
<p><strong>执行存储过程</strong></p>
</blockquote>
<ol>
<li>使用CALL子句执行存储过程，CALL子句接受存储过程的名称以及需要传递的参数。</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"> <span style="color:#66d9ef">CALL</span> ordertotal(<span style="color:#ae81ff">1</span>,<span style="color:#66d9ef">TRUE</span>,<span style="color:#f92672">@</span>total);
 <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">@</span>total;
</code></pre></div><p>如果存储过程中定义了OUT类型的输入参数，那么在执行存储过程时需要传入变量，如这里@total，并且变量都是用@开始的。如果存储过程中没有参数的话，就用空圆括号表示即可，CALL ordertotal()；</p>
<blockquote>
<p><strong>删除存储过程</strong></p>
</blockquote>
<ol>
<li>删除存储过程，可以使用DROP PROCEDURE子句。如DROP PROCEDURE ordertotal；</li>
</ol>
<blockquote>
<p><strong>查询存储过程</strong></p>
</blockquote>
<ol>
<li>显示创建一个存储过程的语句，可以使用SHOW CREATE PROCEDURE。如SHOW CREATE PROCEDURE ordertotal；</li>
<li>查询所有存储过程的状态，如果在定义存储过程中使用COMMENT添加注释，可以查看。同时可以LIKE进行过滤结果。如SHOW PROCEDURE STATUS LIKE &lsquo;%order%';</li>
</ol>
<h2 id="6-事务处理">6. 事务处理</h2>
<ol>
<li>什么是事务？</li>
<li>事务处理是用来维护数据库的完整性，它保证成批的MySQL操作要么完全执行，要么完全不执行。事务处理是一种机制，用来管理必须成批执行的MySQL操作，它们要么时作为整体执行或者完全不执行。</li>
<li>关键概念：</li>
<li>事务：是指一组SQL语句；</li>
<li>回退：是指撤销指定的SQL语句的过程；</li>
<li>提交：指将未存储的SQL语句的结果写入数据库表中；</li>
<li>保留点：指事务处理中设置的临时占位符，可以对它发布回退；</li>
<li>如何创建执行事务？</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"> <span style="color:#66d9ef">START</span> <span style="color:#66d9ef">TRANSACTION</span>;
 <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> customers (cust_name,item_price,item_quantity) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;1&#39;</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">18</span>);
 <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> customers;
 SAVEPOINT insertinto;
 <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> customers (cust_name,item_price,item_quantity) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;2&#39;</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">18</span>);
 <span style="color:#66d9ef">ROLLBACK</span> <span style="color:#66d9ef">TO</span> insertinto;
</code></pre></div><ol>
<li>执行结果为：插入数据(&lsquo;1&rsquo;,5,18)有效，因为，只会从保留点SAFEPOINT之后开始回退，也就是说保留点SAFEPOINT之前的SQL语句执行的结果仍然有效。</li>
<li>有这样一些细节：</li>
<li><strong>STAET TRANSACTION</strong>用来表示下面的SQL语句集为一段事务；</li>
<li><strong>SAFEPOINT</strong> 用于指定保留点insertinto；</li>
<li><strong>ROLLBACK TO</strong>表示从指定保留点开始回退，也就是说保留点之前的SQL语句执行结果依然有效。如果仅仅使用<strong>ROLLBACK</strong>进行回退的话就表示从STAET TRANSACTION之后所有的SQL语句执行效果都会撤销；</li>
<li>MySQL提交（写或保存）操作是自动进行的，这称之为隐含提交。但是在事务处理块中，提交不会隐含进行，要使用COMMIT子句进行提交。如：</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"> <span style="color:#66d9ef">START</span> <span style="color:#66d9ef">TRANSACTION</span>;
 <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> customers (cust_name,item_price,item_quantity) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;1&#39;</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">18</span>);
 <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> customers (cust_name,item_price,item_quantity) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;2&#39;</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">18</span>);
 <span style="color:#66d9ef">COMMIT</span>;
</code></pre></div><p>采用COMMIT提交事务，如果两条SQL语句都执行成功，才会将数据都写入表中。</p>
<h2 id="7-触发器">7. 触发器</h2>
<ol>
<li>什么是触发器？</li>
<li>当某条SQL语句发生时，自动执行某些其他的SQL语句的时候就需要使用到触发器。触发器只能响应：DELETE，INSERT,UPDATE这三个特定操作。</li>
<li>创建触发器？</li>
<li>创建触发器时需要给出最重要的四条信息：1.全局唯一的触发器名；2.触发器关联的表；3.触发器在何时执行（操作执行之前或者之后）4.触发器应该响应的活动（DELETE, INSERT或者UPDATE）；</li>
<li>由于触发器只能响应特定的三种类型的操作，因此可创建的触发器也就三种类型:INSERT触发器，DELETE触发器以及UPDATE触发器。</li>
</ol>
<blockquote>
<p><strong>INSERT触发器</strong></p>
</blockquote>
<ol>
<li>在执行INSERT触发器时，也这样几点需要注意：1.在INSERT触发器代码内，可以引用一个名为NEW的虚拟表，可以用NEW来访问刚插入的行数据；2.在BEFORE INSERT触发器中，NEW中的值可以被更新；3.对于AUTO_INCREMENT列，NEW在INSERT执行之前包含0，在INSERT执行之后包含新的自定生成值。</li>
<li>创建一个INSERT触发器，每次插入一行数据，每次会返回当前插入的行数据的id。</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"> <span style="color:#75715e">/*创建触发器*/</span>
 <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TRIGGER</span> insertcustomers <span style="color:#66d9ef">AFTER</span> <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">ON</span> customers
 <span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">EACH</span> <span style="color:#66d9ef">ROW</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">NEW</span>.cust_id <span style="color:#66d9ef">INTO</span> <span style="color:#f92672">@</span>newinsertid;
 
 <span style="color:#75715e">/*执行触发器*/</span>
 <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> customers (cust_name,item_price,item_quantity) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;2&#39;</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">18</span>);
 <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">@</span>newinsertid;
</code></pre></div><ol>
<li>有这样一些细节：</li>
<li>使用CREATE TRIGGER来创建触发器；</li>
<li>AFTER INSERT表明在插入行数据之后，触发器才会执行特征操作；</li>
<li>FOR EACH ROW 表示对插入的每一行数据，触发器都起作用；</li>
<li>针对INSERT触发器，可以使用虚拟表NEW，来使用刚插入的行数据。比如例子中，SELECT NEW.cust_id INTO @newinsertid表示将新插入的行数据的id赋值给变量@newinsertid；</li>
</ol>
<blockquote>
<p><strong>DELETE触发器</strong></p>
</blockquote>
<ol>
<li>DELETE触发器在DELETE语句执行之前或者之后，需要知道以下两点：</li>
<li>在DELETE触发器代码内，可以引用一个名为OLD的虚拟表，来访问被删除的行；</li>
<li>OLD表中的数据只能读，不能被更新，而在INSERT触发器中，就可以通过NEW来更新被插入的行数据；</li>
<li>例如，针对customers表，当删除一行数据时，返回被删除数据的cust_id以及cust_name:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"> <span style="color:#75715e">/*创建DELETE触发器*/</span>
 
 <span style="color:#66d9ef">DELIMITER</span> <span style="color:#f92672">//</span>
 <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TRIGGER</span> insertcustomers <span style="color:#66d9ef">AFTER</span> <span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">ON</span> customers
 <span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">EACH</span> <span style="color:#66d9ef">ROW</span> 
 <span style="color:#66d9ef">BEGIN</span> 
 <span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">OLD</span>.cust_name <span style="color:#66d9ef">INTO</span> <span style="color:#f92672">@</span>deletecustname;
 <span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">OLD</span>.cust_id <span style="color:#66d9ef">INTO</span> <span style="color:#f92672">@</span>deletecustid;
 <span style="color:#66d9ef">END</span> <span style="color:#f92672">//</span>
 
 <span style="color:#75715e">/*调用DELETE触发器*/</span>
 <span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">FROM</span> customers <span style="color:#66d9ef">WHERE</span> cust_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;
 <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">@</span>deletecustname;
 <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">@</span>deletecustid;
</code></pre></div><ol>
<li>基本上与创建INSERT触发器一样，只不过在DELETE触发器中只能使用OLD来访问被删除的行数据。</li>
</ol>
<blockquote>
<p><strong>UPDATE触发器</strong></p>
</blockquote>
<ol>
<li>UPDATE触发器在UPDATE语句执行之前或者之后执行，需要知道一下几点：</li>
<li>在BEFORE UPDATE触发器中可以使用NEW和OLD来访问数据，而在AFTER UPDATE触发器中使用NEW来访问数据会报错，只能使用OLD来访问数据；</li>
<li>在BEFORE UPDATE触发器中，NEW中的值可以被改变，即允许更改将用于UPDATE的数据；</li>
<li>OLD中的行数据只能读，不能被更新；</li>
<li>一个UPDATE触发器示例如下：</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"> <span style="color:#75715e">/*创建UPDATE触发器*/</span>
 
 <span style="color:#66d9ef">DELIMITER</span> <span style="color:#f92672">//</span>
 <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TRIGGER</span> insertcustomers <span style="color:#66d9ef">BEFORE</span> <span style="color:#66d9ef">UPDATE</span> <span style="color:#66d9ef">ON</span> customers
 <span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">EACH</span> <span style="color:#66d9ef">ROW</span> 
 <span style="color:#66d9ef">BEGIN</span> 
 
 <span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">NEW</span>.cust_name <span style="color:#66d9ef">INTO</span> <span style="color:#f92672">@</span>beforeupdate;
 <span style="color:#66d9ef">SET</span> <span style="color:#66d9ef">NEW</span>.cust_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;reset_name&#39;</span>;
 <span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">OLD</span>.cust_name <span style="color:#66d9ef">INTO</span> <span style="color:#f92672">@</span>afterupdate;
 <span style="color:#66d9ef">END</span> <span style="color:#f92672">//</span>
 
 <span style="color:#75715e">/*调用UPDATE触发器*/</span>
 <span style="color:#66d9ef">UPDATE</span> customers <span style="color:#66d9ef">SET</span> cust_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;happy&#39;</span> <span style="color:#66d9ef">WHERE</span> cust_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>;
 <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">@</span>beforeupdate;
 <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">@</span>afterupdate;
</code></pre></div><ol>
<li>输出为@beforeupdate为‘happay’，而@afterupdate为&rsquo;reset_name&rsquo;。有这样一些细节：</li>
<li>NEW虚拟表中的数据可以更改，如这里采用 SET NEW.cust_name = &lsquo;reset_name&rsquo;;，将待更新的cust_name由“happy”变成了“reset_name”；</li>
<li>在BEFORE UPDATE触发器中可以使用NEW和OLD来访问数据，而在AFTER UPDATE触发器中使用NEW来访问数据会报错；</li>
<li>删除触发器？</li>
<li>删除触发器，可以使用 DROP TRIGGER语句，比如DROP TRIGGER insertcustomers;。触发器不能更新或者覆盖，如果要修改触发器，必须删除这个触发器。</li>
</ol>


                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/mysql%E4%BC%98%E5%8C%96%E5%AE%9E%E6%96%BD%E6%96%B9%E6%A1%88/" data-toggle="tooltip" data-placement="top" title="MySQL数据库优化方案">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/post/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E6%AF%95%E4%B8%9A%E8%AE%BE%E8%AE%A1%E5%AE%8C%E6%95%B4%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE%E6%90%AD%E5%BB%BA%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F&#43;java%E5%90%8E%E5%8F%B0ssm%E6%A1%86%E6%9E%B6/" data-toggle="tooltip" data-placement="top" title="微信小程序-毕业设计完整项目配置搭建（微信小程序&#43;Java后台SSM框架）">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>

                
<div id="disqus-comment"></div>



            </div>
            
            <div class="
                col-lg-11 col-lg-offset-1
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        <a href="/tags/java" title="java">
                            java
                        </a>
                        
                        
                        
                        <a href="/tags/mysql" title="mysql">
                            mysql
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/wechat" title="wechat">
                            wechat
                        </a>
                        
                        
                        
                        
                    </div>
                </section>
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                    
                    <li>
                        <a href="mailto:tang897396324@163.com">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    

                    
                    
                    

                    

		    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/tangjiadong">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    <li>
                        <a target="_blank" href="https://gitee.com/tangjiadong">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-git fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
            
                    
                    
                    
                    
                    
                    
            
            
            
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; Tang Blog 2021
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






</body>
</html>
